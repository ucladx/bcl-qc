// nextflow.config - BCL-QC Pipeline Configuration

// Working directory for intermediate files
workDir = '/staging/tmp/nextflow'

params {
    // Input/Output
    run_dir         = null
    sampleinfo      = null
    fastqs_dir      = "/staging/hot/reads"
    bams_dir        = "/mnt/pns/bams"
    outdir          = null  // Will default to bams_dir/run_name

    // Reference files
    picard_ref      = "/mnt/pns/tracks/ref/hg38.fa"

    // Panel configurations
    panels {
        PCP {
            bed       = "/mnt/pns/tracks/ucla_mdl_cancer_ngs_v1_exon_targets.hg38.bed"
            human_ref = "/staging/human/reference/hg38_alt_masked_graph_v3"
        }
        HEME {
            bed       = "/mnt/pns/tracks/goal_ucla_heme_221_exon_targets.hg38.bed"
            human_ref = "/staging/human/reference/hg38_alt_masked_graph_v3"
        }
    }

    // Steps to run
    skip_demux  = false
    skip_align  = false
    skip_qc     = false
}

process {
    withLabel: 'dragen' {
        // Dragen requires exclusive hardware access - only one process at a time
        maxForks = 1
    }

    withLabel: 'low_memory' {
        memory = '4 GB'
        cpus = 2
    }

    withLabel: 'medium_memory' {
        memory = '16 GB'
        cpus = 4
    }
}



profiles {
    standard {
        process.executor = 'local'
    }

    slurm {
        process.executor = 'slurm'
        process.queue = 'normal'
    }

    conda {
        conda.enabled = true
        process.conda = "${projectDir}/config/conda_env.yaml"
    }
}

// Manifest
manifest {
    name            = 'bcl-qc'
    author          = 'UCLA MDL'
    description     = 'BCL QC pipeline for NovaSeq runs'
    mainScript      = 'main.nf'
    nextflowVersion = '>=23.04.0'
    version         = '2.0.0'
}

// Reporting
timeline {
    enabled = true
    file    = "${params.outdir}/pipeline_info/timeline.html"
    overwrite = true
}

report {
    enabled = true
    file    = "${params.outdir}/pipeline_info/report.html"
    overwrite = true
}

trace {
    enabled = true
    file    = "${params.outdir}/pipeline_info/trace.txt"
    overwrite = true
}
